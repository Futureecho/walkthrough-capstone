<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reset Password - Walkthru-X</title>
<link rel="icon" type="image/x-icon" href="/static/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/static/images/verentyx-icon-32.png">
<link rel="apple-touch-icon" href="/static/images/verentyx-icon-180.png">
<link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
<div class="header">
  <div style="text-align:center">
    <a href="/owner"><img src="/static/images/walkthru-x-logo.png" alt="Walkthru-X" class="app-logo"></a>
  </div>
</div>

<div class="container">
  <div class="card" id="reset-card">
    <h2>Set New Password</h2>
    <form id="reset-form" autocomplete="off">
      <label style="font-size:.85rem;color:var(--text-muted);display:block;margin-bottom:.25rem">New Password</label>
      <input type="password" id="new-password" placeholder="At least 8 characters" autocomplete="new-password" required>

      <label style="font-size:.85rem;color:var(--text-muted);display:block;margin-bottom:.25rem">Confirm Password</label>
      <input type="password" id="confirm-password" placeholder="Confirm password" autocomplete="new-password" required>

      <div id="reset-error" style="color:var(--danger);font-size:.9rem;margin-bottom:.5rem;display:none"></div>
      <button type="submit" class="btn btn-primary btn-block">Reset Password</button>
    </form>
  </div>

  <div class="card hidden" id="success-card">
    <h2>Password Updated</h2>
    <p class="text-muted">Your password has been reset. You can now log in.</p>
    <a href="/owner/login" class="btn btn-primary btn-block" style="margin-top:1rem">Go to Login</a>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const token = window.location.pathname.split('/reset-password/')[1];

  document.getElementById('reset-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const errEl = document.getElementById('reset-error');
    errEl.style.display = 'none';

    const newPassword = document.getElementById('new-password').value;
    const confirm = document.getElementById('confirm-password').value;

    if (newPassword.length < 8) { showError(errEl, 'Password must be at least 8 characters'); return; }
    if (newPassword !== confirm) { showError(errEl, 'Passwords do not match'); return; }

    try {
      const r = await fetch('/api/auth/password/reset', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token, new_password: newPassword }),
      });
      const data = await r.json();
      if (!r.ok) { showError(errEl, data.detail || 'Reset failed'); return; }

      document.getElementById('reset-card').classList.add('hidden');
      document.getElementById('success-card').classList.remove('hidden');
    } catch (err) {
      showError(errEl, 'Connection error');
    }
  });
});

function showError(el, msg) {
  el.textContent = msg;
  el.style.display = 'block';
}
</script>
</body>
</html>
